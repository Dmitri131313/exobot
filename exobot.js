require("source-map-support").install();
!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t(require("cryptr"),require("eventemitter3"),require("fs-extra"),require("lodash"),require("lodash/array"),require("log"),require("lowdb"),require("node-uuid"),require("proptypes"),require("readline"),require("superagent"),require("superagent-promise-plugin"),require("underscore-db")):"function"==typeof define&&define.amd?define(["cryptr","eventemitter3","fs-extra","lodash","lodash/array","log","lowdb","node-uuid","proptypes","readline","superagent","superagent-promise-plugin","underscore-db"],t):"object"==typeof exports?exports["exobot.js"]=t(require("cryptr"),require("eventemitter3"),require("fs-extra"),require("lodash"),require("lodash/array"),require("log"),require("lowdb"),require("node-uuid"),require("proptypes"),require("readline"),require("superagent"),require("superagent-promise-plugin"),require("underscore-db")):e["exobot.js"]=t(e.cryptr,e.eventemitter3,e["fs-extra"],e.lodash,e["lodash/array"],e.log,e.lowdb,e["node-uuid"],e.proptypes,e.readline,e.superagent,e["superagent-promise-plugin"],e["underscore-db"])}(this,function(e,t,r,n,i,o,a,u,s,c,p,l,f){return function(e){function t(n){if(r[n])return r[n].exports;var i=r[n]={i:n,l:!1,exports:{}};return e[n].call(i.exports,i,i.exports,t),i.l=!0,i.exports}var r={};return t.m=e,t.c=r,t.i=function(e){return e},t.d=function(e,t,r){Object.defineProperty(e,t,{configurable:!1,enumerable:!0,get:r})},t.n=function(e){var r=e&&e.__esModule?function(){return e["default"]}:function(){return e};return t.d(r,"a",r),r},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.p="",t(t.s=32)}([function(e,t,r){"use strict";function n(e){return function(){var t=e.apply(this,arguments);return new Promise(function(e,r){function n(i,o){try{var a=t[i](o),u=a.value}catch(s){return void r(s)}return a.done?void e(u):Promise.resolve(u).then(function(e){return n("next",e)},function(e){return n("throw",e)})}return n("next")})}}function i(e){if(Array.isArray(e)){for(var t=0,r=Array(e.length);t<e.length;t++)r[t]=e[t];return r}return Array.from(e)}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function a(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function u(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var s=r(1),c=r(10);r.d(t,"e",function(){return v}),r.d(t,"c",function(){return b}),r.d(t,"d",function(){return y}),r.d(t,"a",function(){return m}),r.d(t,"b",function(){return g});var p=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},l=function(){function e(e,t){var r=[],n=!0,i=!1,o=void 0;try{for(var a,u=e[Symbol.iterator]();!(n=(a=u.next()).done)&&(r.push(a.value),!t||r.length!==t);n=!0);}catch(s){i=!0,o=s}finally{try{!n&&u["return"]&&u["return"]()}finally{if(i)throw o}}return r}return function(t,r){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return e(t,r);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),f=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),h=function w(e,t,r){null===e&&(e=Function.prototype);var n=Object.getOwnPropertyDescriptor(e,t);if(void 0===n){var i=Object.getPrototypeOf(e);return null===i?void 0:w(i,t,r)}if("value"in n)return n.value;var o=n.get;if(void 0!==o)return o.call(r)},d=/.+/,v=function(e){function t(){o(this,t);var e=a(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments));return e.regexp=d,e.respondFunctions=[],e.listenFunctions=[],e.help=[],e}return u(t,e),f(t,[{key:"helpText",value:function(){var e=this;return this.help.map(function(t){return"["+e[t].permissionGroup+"] "+e[t].help})}},{key:"register",value:function(e){var r=this;h(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"register",this).call(this,e),this.bot=e,this.botNameRegex=new RegExp("^(?:(?:@?"+e.name+"|"+e.alias+")[,\\s:.-]*)(.+)","i"),this.postConstructor&&this.postConstructor.forEach(function(e){var t=l(e,2),n=t[0],o=t[1];return n.call.apply(n,[r].concat(i(o)))}),e.emitter.on("receive-message",function(e){var t=r.stripLeadingBotName(e.text),n=[];t&&!function(){var o=new c.a(p({},e,{text:t}));r.respondFunctions.forEach(function(e){return r.process.apply(r,i(e).concat([o]))}),n=r.respondFunctions.map(function(e){var t=l(e,3),r=t[2];return r})}(),r.listenFunctions.filter(function(e){var t=l(e,3),r=t[2];return!n.includes(r)}).forEach(function(t){return r.process.apply(r,i(t).concat([e]))})})}},{key:"process",value:function(){function e(e,r,n,i){return t.apply(this,arguments)}var t=n(regeneratorRuntime.mark(function r(e,t,n,i){var o,a,u,s,l,f;return regeneratorRuntime.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:if(r.prev=0,o=e.exec?this.validateMessage(e):e,a=o(i),!a){r.next=18;break}return r.next=6,this.checkPermissions(i.user.id,this[n].permissionGroup);case 6:if(!r.sent){r.next=18;break}if(u=t.call(this,a,i)){r.next=10;break}return r.abrupt("return");case 10:if(!(u instanceof Promise)){r.next=16;break}return r.next=13,u;case 13:return s=r.sent,l=new c.a(p({},i,{text:s})),r.abrupt("return",this.bot.send(l));case 16:f=new c.a(p({},i,{text:u})),this.bot.send(f);case 18:r.next=23;break;case 20:r.prev=20,r.t0=r["catch"](0),this.bot.log.warning(r.t0);case 23:case"end":return r.stop()}},r,this,[[0,20]])}));return e}()},{key:"checkPermissions",value:function(){function e(e,r){return t.apply(this,arguments)}var t=n(regeneratorRuntime.mark(function r(e,t){return regeneratorRuntime.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return r.abrupt("return",this.bot.checkPermissions(e,t));case 1:case"end":return r.stop()}},r,this)}));return e}()},{key:"stripLeadingBotName",value:function(e){var t=this.botNameRegex.exec(e);if(t)return t[1]}},{key:"respond",value:function(e,t,r){this.respondFunctions.push([e,t,r])}},{key:"listen",value:function(e,t,r){this.listenFunctions.push([e,t,r])}},{key:"setHelp",value:function(e,t){this.help.push(t),this[t].help=e}},{key:"setPermissionGroup",value:function(e,t){this[e].permissionGroup=this.name+"."+t}},{key:"validateMessage",value:function(e){return function(t){return e.exec(t.text)}}}]),t}(s.a),b=function(e){return function(t,r,n){var i=n.value;i.permissionGroup||(i.permissionGoup=t.name+"."+r),t.postConstructor=t.postConstructor||[],t.postConstructor.push([t.listen,[e,i,r]])}},y=function(e){return function(t,r,n){var i=n.value;i.permissionGroup||(i.permissionGoup=t.name+"."+r),t.postConstructor=t.postConstructor||[],t.postConstructor.push([t.respond,[e,i,r]])}},m=function(e){return function(t,r){t.postConstructor.push([t.setHelp,[e,r]])}},g=function(e){return function(t,r){t.postConstructor.push([t.setPermissionGroup,[r,e]])}}},function(e,t,r){"use strict";function n(e){return function(){var t=e.apply(this,arguments);return new Promise(function(e,r){function n(i,o){try{var a=t[i](o),u=a.value}catch(s){return void r(s)}return a.done?void e(u):Promise.resolve(u).then(function(e){return n("next",e)},function(e){return n("throw",e)})}return n("next")})}}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}r.d(t,"a",function(){return s});var o=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},a=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),u=/([a-z][A-Z])/g,s=function(){function e(){var t=arguments.length<=0||void 0===arguments[0]?{}:arguments[0];i(this,e),this.help=void 0,this._requiresDatabase=!1,this.propTypes=null,this.defaultProps={},this.options=t}return a(e,[{key:"register",value:function(e){if(this.bot=e,this.options=this.parseConfig(o({},this.defaultProps,this.options)),this.propTypes&&Object.keys(this.propTypes).length&&this.checkConfig(this.options,this.propTypes,e),!e)throw new Error("No bot passed to register; fatal.");if(!this.name)throw new Error("This plugin has a missing `name` property.");this.propTypes||e.log.notice('Plugin "'+this.name+'" does not define propTypes; it should.'),this.database()}},{key:"listen",value:function(){if(!this.bot)throw new Error("No bot to listen on; fatal.")}},{key:"parseConfig",value:function(){var e=this,t=arguments.length<=0||void 0===arguments[0]?{}:arguments[0],r=Object.keys(t),n=o({},t,Object.keys(this.propTypes||{}).filter(function(e){return!r.includes(e)}).reduce(function(t,r){var n=process.env[e.envify(r)];return n&&(t[r]=n),t},{}));return n}},{key:"checkConfig",value:function(){var e=arguments.length<=0||void 0===arguments[0]?{}:arguments[0],t=this,r=arguments.length<=1||void 0===arguments[1]?{}:arguments[1],n=arguments[2];return Object.keys(r).reduce(function(i,o){if(!r[o])return n.log.warning("Unrecognized prop "+o+" passed into options of "+t.name+" plugin"),!1;var a=r[o](e,o,t.name+" config","property");return a?(n.log.warning(a.toString()),!1):i},!0)}},{key:"envify",value:function(){var e=arguments.length<=0||void 0===arguments[0]?"":arguments[0];return[this.name,e.replace(u,function(e){return e.split("").join("_")})].join("_").toUpperCase()}},{key:"database",value:function(){function e(){return t.apply(this,arguments)}var t=n(regeneratorRuntime.mark(function r(){var e=this;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(!this.defaultDatabase){t.next=4;break}return t.next=3,this.databaseInitialized();case 3:Object.keys(this.defaultDatabase).forEach(function(t){var r=e.bot.db.get(t).value();"undefined"==typeof r&&e.bot.db.set(t,e.defaultDatabase[t]).value()});case 4:case"end":return t.stop()}},r,this)}));return e}()},{key:"databaseInitialized",value:function(){function e(){return t.apply(this,arguments)}var t=n(regeneratorRuntime.mark(function r(){var e=this;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(this._requiresDatabase=!0,!this._requiresDatabase||!this.bot.db){t.next=3;break}return t.abrupt("return",!0);case 3:return t.abrupt("return",new Promise(function(t){e.bot.emitter.on("dbLoaded",t)}));case 4:case"end":return t.stop()}},r,this)}));return e}()}]),e}()},function(e,t,r){"use strict";var n=r(21);for(var i in n)"default"!==i&&function(e){r.d(t,e,function(){return n[e]})}(i)},function(e,t,r){"use strict";var n=r(4),i=r(9),o=r(10);r.o(n,"a")&&r.d(t,"Message",function(){return n.a}),r.o(i,"a")&&r.d(t,"PresenceMessage",function(){return i.a}),r.o(o,"a")&&r.d(t,"TextMessage",function(){return o.a})},function(e,t,r){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var i=r(5);r.n(i);r.d(t,"a",function(){return o});var o=function a(e){var t=e.user,o=e.channel,u=e.adapter,s=e.id,c=void 0===s?r.i(i.v4)():s;n(this,a),this.user=t,this.channel=o,this.adapter=u,this.id=c}},function(e,t){e.exports=require("node-uuid")},function(e,t,r){"use strict";var n=r(24),i=r(25),o=r(26);r.o(n,"a")&&r.d(t,"Greetings",function(){return n.a}),r.o(i,"a")&&r.d(t,"Help",function(){return i.a}),r.o(o,"a")&&r.d(t,"Permissions",function(){return o.a})},function(e,t,r){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var i=r(5);r.n(i);r.d(t,"a",function(){return o});var o=function a(e,t,o){n(this,a),this.name=e,this.id=t||r.i(i.v4)(),this.roles={},this.adapters=o||{}}},function(e,t,r){"use strict";function n(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function i(e){return function(){var t=e.apply(this,arguments);return new Promise(function(e,r){function n(i,o){try{var a=t[i](o),u=a.value}catch(s){return void r(s)}return a.done?void e(u):Promise.resolve(u).then(function(e){return n("next",e)},function(e){return n("throw",e)})}return n("next")})}}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var a=r(10),u=r(9),s=r(7);r.d(t,"a",function(){return f});var c,p,l=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),f=(p=c=function(){function e(){var t=arguments.length<=0||void 0===arguments[0]?{}:arguments[0];o(this,e),this.options=t,this.status=e.STATUS.UNINITIALIZED,this.roleMapping=t.roleMapping}return l(e,[{key:"register",value:function(t){if(!t)throw new Error("No bot passed to register; fatal.");if(!this.name)throw new Error("This adapter has no `name` property; some plugins will not work.");this.bot=t,this.initUsers(),this.status=e.STATUS.CONNECTING,this.listen()}},{key:"listen",value:function(){if(!this.bot)throw new Error("No bot to listen on; fatal.")}},{key:"receive",value:function(e){var t=e.user,r=e.text,n=e.channel,i=e.whisper;if(!r)return void this.bot.log.info("Message received with undefined text.");var o=new a.a({user:t,text:r,channel:n,whisper:i,adapter:this.name});this.bot.emitter.emit("receive-message",o)}},{key:"receiveWhisper",value:function(e){var t=e.user,r=e.text,n=e.channel;return r?(r=this.bot.prependNameForWhisper(r),void this.receive({user:t,text:r,channel:n,whisper:!0})):void this.bot.log.warning("Message received with undefined text.")}},{key:"enter",value:function(e){var t=e.user,r=e.channel,n=new u.a({user:t,channel:r,adapter:this.name,type:u.a.TYPES.ENTER});this.bot.emitter.emit("enter",n)}},{key:"leave",value:function(e){var t=e.user,r=e.channel,n=new u.a({user:t,channel:r,adapter:this.name,type:u.a.TYPES.LEAVE});this.bot.emitter.emit("leave",n)}},{key:"send",value:function(e){console.log(e.text)}},{key:"ping",value:function(){this.pong()}},{key:"pong",value:function(){this.bot.log.warning("Ping received, this.pong() not implemented.")}},{key:"getUserIdByUserName",value:function(e){return this.bot.log.warning("getUserIdByUserName not implemented by this adapter."),e}},{key:"getRoleIdByRoleName",value:function(e){return this.bot.log.warning("getRoleIdByRoleName not implemented by this adapter"),e}},{key:"getRolesForUser",value:function(){return[]}},{key:"initUsers",value:function(){function e(){return t.apply(this,arguments)}var t=i(regeneratorRuntime.mark(function r(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.bot.databaseInitialized();case 2:if(this.adapterUsers=this.bot.users[this.name],!this.adapterUsers){e.next=5;break}return e.abrupt("return");case 5:this.bot.users[this.name]={},this.adapterUsers=this.bot.users[this.name],this.bot.db.write();case 8:case"end":return e.stop()}},r,this)}));return e}()},{key:"getRoles",value:function(){return this.bot.log.warning("getRoles not implemented by this adapter"),!1}},{key:"getUser",value:function(){function e(e,r,n){return t.apply(this,arguments)}var t=i(regeneratorRuntime.mark(function r(e,t){var i,o,a=arguments.length<=2||void 0===arguments[2]?{}:arguments[2];return regeneratorRuntime.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,this.bot.databaseInitialized();case 2:if(e||this.bot.error("Adapter "+this.name+" called getUser without adapterUserId"),t||this.bot.warning("Adapter "+this.name+" called getUser without adapterUsername"),i=this.getRoles(e,a),!this.adapterUsers){r.next=16;break}if(!this.adapterUsers[e]){r.next=10;break}return i&&(console.log("1"),this.adapterUsers[e].roles=i),t&&(this.bot.users.botUsers[this.adapterUsers[e].botId].name=t),r.abrupt("return",this.bot.users.botUsers[this.adapterUsers[e].botId]);case 10:return o=new s.a(t),o.adapters=n({},this.name,{userId:e}),this.adapterUsers[e]={name:t,botId:o.id,roles:i||[]},this.bot.users.botUsers[o.id]=o,this.bot.db.write(),r.abrupt("return",o);case 16:return r.abrupt("return",new s.a(t,e,n({},this.name,e)));case 17:case"end":return r.stop()}},r,this)}));return e}()}]),e}(),c.STATUS={UNINITIALIZED:0,CONNECTING:1,CONNECTED:2,DISCONNECTED:3,RECONNECTING:4,ERROR:5},p)},function(e,t,r){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var a=r(4);r.d(t,"a",function(){return c});var u,s,c=(s=u=function(e){function t(e){var r=e.type;n(this,t);var o=i(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments));return o.type=r,o}return o(t,e),t}(a.a),u.TYPES={ENTER:0,LEAVE:1},s)},function(e,t,r){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var a=r(4);r.d(t,"a",function(){return u});var u=function(e){function t(e){var r=e.text,o=e.whisper,a=void 0!==o&&o;n(this,t);var u=i(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments));return r&&(u.text=r.trim()),u.whisper=!!a,u}return o(t,e),t}(a.a)},function(e,t,r){"use strict";var n=r(8),i=r(19);r.d(t,"adapters",function(){return o}),r.o(n,"a")&&r.d(t,"Adapter",function(){return n.a});var o=i},function(e,t,r){"use strict";var n=r(1),i=r(22),o=r(23),a=r(0),u=r(6);r.d(t,"plugins",function(){return s}),r.o(n,"a")&&r.d(t,"Plugin",function(){return n.a}),r.o(i,"a")&&r.d(t,"EventPlugin",function(){return i.a}),r.o(o,"a")&&r.d(t,"HTTPPlugin",function(){return o.a}),r.o(a,"e")&&r.d(t,"ChatPlugin",function(){return a.e}),r.o(a,"d")&&r.d(t,"respond",function(){return a.d}),r.o(a,"c")&&r.d(t,"listen",function(){return a.c}),r.o(a,"a")&&r.d(t,"help",function(){return a.a}),r.o(a,"b")&&r.d(t,"permissionGroup",function(){return a.b});var s=u},function(e,t){e.exports=require("eventemitter3")},function(e,t){e.exports=require("lodash")},function(e,t){e.exports=require("lodash/array")},function(e,t){e.exports=require("log")},function(e,t){e.exports=require("superagent")},function(e,t){e.exports=require("superagent-promise-plugin")},function(e,t,r){"use strict";var n=r(20);r.o(n,"a")&&r.d(t,"Shell",function(){return n.a})},function(e,t,r){"use strict";function n(e){return function(){var t=e.apply(this,arguments);return new Promise(function(e,r){function n(i,o){try{var a=t[i](o),u=a.value}catch(s){return void r(s)}return a.done?void e(u):Promise.resolve(u).then(function(e){return n("next",e)},function(e){return n("throw",e)})}return n("next")})}}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function a(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var u=r(30),s=r.n(u),c=r(8);r.d(t,"a",function(){return d});var p=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),l=function v(e,t,r){null===e&&(e=Function.prototype);var n=Object.getOwnPropertyDescriptor(e,t);if(void 0===n){var i=Object.getPrototypeOf(e);return null===i?void 0:v(i,t,r)}if("value"in n)return n.value;var o=n.get;if(void 0!==o)return o.call(r)},f="SHELL",h=["exit","quit","q"],d=function(e){function t(){i(this,t);var e=o(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.name="shell",e.rl=s.a.createInterface({input:process.stdin,output:process.stdout}),e}return a(t,e),p(t,[{key:"prompt",value:function(){function e(){return r.apply(this,arguments)}var r=n(regeneratorRuntime.mark(function i(){var e=this;return regeneratorRuntime.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,this.bot.databaseInitialized();case 2:return r.next=4,this.getUser("shell","shell");case 4:this.user=r.sent,this.rl.question("Chat: ",function(r){h.includes(r)&&e.bot.db.write().then(function(){return process.exit()}),l(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"receive",e).call(e,{text:r,channel:f,user:e.user}),e.prompt()});case 6:case"end":return r.stop()}},i,this)}));return e}()},{key:"register",value:function(e){l(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"register",this).call(this,e),this.prompt(),this.status=c.a.STATUS.CONNECTED}},{key:"getUserIdByUserName",value:function(){return this.user.id}}]),t}(c.a)},function(e,t,r){"use strict";function n(e){return function(){var t=e.apply(this,arguments);return new Promise(function(e,r){function n(i,o){try{var a=t[i](o),u=a.value}catch(s){return void r(s)}return a.done?void e(u):Promise.resolve(u).then(function(e){return n("next",e)},function(e){return n("throw",e)})}return n("next")})}}var i=r(27),o=r.n(i),a=r(29),u=r.n(a),s=r(28),c=r.n(s),p=r(31),l=r.n(p);r.d(t,"deserialize",function(){return f}),r.d(t,"serialize",function(){return h}),r.d(t,"read",function(){return d}),r.d(t,"write",function(){return v}),r.d(t,"readLocal",function(){return b}),r.d(t,"writeLocal",function(){return y}),r.d(t,"DB",function(){return m});var f=function(e){return function(t){if(!t)return{};var r=e.decrypt(t),n=JSON.parse(r);return n}},h=function(e){return function(t){var r=JSON.stringify(t),n=e.encrypt(r);return n}},d=function(e){return function(t,r){return new Promise(function(n,i){e(t).then(function(e){try{n(r(e))}catch(t){i(t)}})})}},v=function(e){return function(t,r,n){return new Promise(function(i,o){try{var a=n(r);e(t,a).then(i,o)}catch(u){o(u)}})}},b=function(e){return new Promise(function(t,r){c.a.ensureFile(e,function(n){return n?r(n):void c.a.readFile(e,"utf8",function(e,n){return e?r(e):t(n)})})})},y=function(e,t){return new Promise(function(r,n){c.a.ensureFile(e,function(i){return i?n(i):void c.a.writeFile(e,t,"utf8",function(e){return e?n(e):r(t)})})})},m=function(){var e=n(regeneratorRuntime.mark(function t(e){var r,n,i,a=e.path,s=e.key,c=e.readFile,p=void 0===c?b:c,m=e.writeFile,g=void 0===m?y:m;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=new o.a(s||name),n=a||"./data/"+name+".json",e.next=4,new u.a(n,{storage:{read:d(p),write:v(g)},format:{deserialize:f(r),serialize:h(r)}});case 4:return i=e.sent,i._.mixin(l.a),e.abrupt("return",i);case 7:case"end":return e.stop()}},t,this)}));return function(t){return e.apply(this,arguments)}}()},function(e,t,r){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var a=r(1);r.d(t,"a",function(){return u});var u=function(e){function t(){return n(this,t),i(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return o(t,e),t}(a.a)},function(e,t,r){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var a=r(1);r.d(t,"a",function(){return u});var u=function(e){function t(){return n(this,t),i(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return o(t,e),t}(a.a)},function(e,t,r){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function a(e,t,r,n,i){var o={};return Object.keys(n).forEach(function(e){o[e]=n[e]}),o.enumerable=!!o.enumerable,o.configurable=!!o.configurable,("value"in o||o.initializer)&&(o.writable=!0),o=r.slice().reverse().reduce(function(r,n){return n(e,t,r)||r},o),i&&void 0!==o.initializer&&(o.value=o.initializer?o.initializer.call(i):void 0,o.initializer=void 0),void 0===o.initializer&&(Object.defineProperty(e,t,o),o=null),o}var u=r(0);r.d(t,"a",function(){return O});var s,c,p,l,f,h,d,v,b,y=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),m=["hi","hello","sup","greetings","yo","hey"],g=["goodbye","farwell","bye","later","see ya","cya"],w=function(e){return m.includes(e.text.toLowerCase())},x=function(e){return g.includes(e.text.toLowerCase())},O=(s=r.i(u.a)("Greets you back when you greet the channel."),c=r.i(u.b)("greetings"),p=r.i(u.c)(w),l=r.i(u.d)(w),f=r.i(u.a)("Says goodbye when you do."),h=r.i(u.b)("greetings"),d=r.i(u.c)(x),v=r.i(u.d)(x),b=function(e){function t(){var e,r,o,a;n(this,t);for(var u=arguments.length,s=Array(u),c=0;c<u;c++)s[c]=arguments[c];return r=o=i(this,(e=t.__proto__||Object.getPrototypeOf(t)).call.apply(e,[this].concat(s))),o.name="greeting",o.propTypes={},a=r,i(o,a)}return o(t,e),y(t,[{key:"greeting",value:function(e,t){var r=m[parseInt(Math.random()*m.length)];return r+", "+t.user.name+"!"}},{key:"farewell",value:function(e,t){var r=g[parseInt(Math.random()*g.length)];return r+", "+t.user.name+"!"}}]),t}(u.e),a(b.prototype,"greeting",[s,c,p,l],Object.getOwnPropertyDescriptor(b.prototype,"greeting"),b.prototype),a(b.prototype,"farewell",[f,h,d,v],Object.getOwnPropertyDescriptor(b.prototype,"farewell"),b.prototype),b)},function(e,t,r){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function a(e,t,r,n,i){var o={};return Object.keys(n).forEach(function(e){o[e]=n[e]}),o.enumerable=!!o.enumerable,o.configurable=!!o.configurable,("value"in o||o.initializer)&&(o.writable=!0),o=r.slice().reverse().reduce(function(r,n){return n(e,t,r)||r},o),i&&void 0!==o.initializer&&(o.value=o.initializer?o.initializer.call(i):void 0,o.initializer=void 0),void 0===o.initializer&&(Object.defineProperty(e,t,o),o=null),o}var u=r(0);r.d(t,"a",function(){return y});var s,c,p,l,f,h,d,v=function(){function e(e,t){var r=[],n=!0,i=!1,o=void 0;try{for(var a,u=e[Symbol.iterator]();!(n=(a=u.next()).done)&&(r.push(a.value),!t||r.length!==t);n=!0);}catch(s){i=!0,o=s}finally{try{!n&&u["return"]&&u["return"]()}finally{if(i)throw o}}return r}return function(t,r){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return e(t,r);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),b=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),y=(s=r.i(u.a)("/help explains commands."),c=r.i(u.b)("help"),p=r.i(u.d)(/^help$/i),l=r.i(u.a)("/help <search> finds information about a specific command."),f=r.i(u.b)("help"),h=r.i(u.d)(/^help (\w+)$/i),d=function(e){function t(){var e,r,o,a;n(this,t);for(var u=arguments.length,s=Array(u),c=0;c<u;c++)s[c]=arguments[c];return r=o=i(this,(e=t.__proto__||Object.getPrototypeOf(t)).call.apply(e,[this].concat(s))),o.name="help",o.propTypes={},a=r,i(o,a)}return o(t,e),b(t,[{key:"pluginHelp",value:function(){return this.bot.plugins.filter(function(e){return e.help&&e.help.length>0}).map(function(e){return e.helpText().join("\n")},[]).join("\n")}},{key:"pluginHelpSearch",value:function(e){var t=v(e,2),r=t[1];return this.bot.plugins.filter(function(e){return e.help&&e.help.length>0}).map(function(e){return e.helpText().filter(function(e){return e.toLowerCase().indexOf(r.toLowerCase())>-1}).join("\n")},[]).join("\n")}}]),t}(u.e),a(d.prototype,"pluginHelp",[s,c,p],Object.getOwnPropertyDescriptor(d.prototype,"pluginHelp"),d.prototype),a(d.prototype,"pluginHelpSearch",[l,f,h],Object.getOwnPropertyDescriptor(d.prototype,"pluginHelpSearch"),d.prototype),d)},function(e,t,r){"use strict";function n(e){return function(){var t=e.apply(this,arguments);return new Promise(function(e,r){function n(i,o){try{var a=t[i](o),u=a.value}catch(s){return void r(s)}return a.done?void e(u):Promise.resolve(u).then(function(e){return n("next",e)},function(e){return n("throw",e)})}return n("next")})}}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function a(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function u(e,t,r,n,i){var o={};return Object.keys(n).forEach(function(e){o[e]=n[e]}),o.enumerable=!!o.enumerable,o.configurable=!!o.configurable,("value"in o||o.initializer)&&(o.writable=!0),
o=r.slice().reverse().reduce(function(r,n){return n(e,t,r)||r},o),i&&void 0!==o.initializer&&(o.value=o.initializer?o.initializer.call(i):void 0,o.initializer=void 0),void 0===o.initializer&&(Object.defineProperty(e,t,o),o=null),o}var s=r(0),c=r(32),p=r(5);r.n(p);r.d(t,"a",function(){return M});var l,f,h,d,v,b,y,m,g,w,x,O,k,P,j,R,_,T,E,U,I,C,q,z,N,L,S,A,D,G,F=function(){function e(e,t){var r=[],n=!0,i=!1,o=void 0;try{for(var a,u=e[Symbol.iterator]();!(n=(a=u.next()).done)&&(r.push(a.value),!t||r.length!==t);n=!0);}catch(s){i=!0,o=s}finally{try{!n&&u["return"]&&u["return"]()}finally{if(i)throw o}}return r}return function(t,r){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return e(t,r);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),B=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),M=(l=r.i(s.a)("/permissions authorize admin <password> to authorize yourself as an admin"),f=r.i(s.b)("public"),h=r.i(s.d)(/^permissions authorize admin (.+)$/i),d=r.i(s.a)("/permissions add role <role> to <user> to add a role to a user"),v=r.i(s.b)("role-management"),b=r.i(s.d)(/^permissions add role (\w+) to (.+)$/i),y=r.i(s.a)("/permissions view user <user> to view roles given to a user"),m=r.i(s.b)("role-management"),g=r.i(s.d)(/^permissions view user (.+)$/i),w=r.i(s.a)("/permissions view effective user <user> to view all roles assigned to <user>"),x=r.i(s.b)("role-management"),O=r.i(s.d)(/^permissions view effective user (.+)$/i),k=r.i(s.a)("/permissions remove role <role> from <user> to remove a role from a user"),P=r.i(s.b)("role-management"),j=r.i(s.d)(/^permissions remove role (\w+) from (.+)$/i),R=r.i(s.a)("/permissions add role <permissiongroup> <role> to allow access to a permissionGroup"),_=r.i(s.b)("role-management"),T=r.i(s.d)(/^permissions add role (\S+) (\w+)$/i),E=r.i(s.a)("/permissions remove group <permissionGroup> <role> to allow access to a permissionGroup"),U=r.i(s.b)("role-management"),I=r.i(s.d)(/^permissions remove role (\S+) (\w+)$/i),C=r.i(s.a)("/permissions view group <permissionGroup> to view roles with access to commands under that permissionGroup"),q=r.i(s.b)("role-management"),z=r.i(s.d)(/^permissions view group (\S+)$/i),N=r.i(s.a)("/login to recieve a token to claim your users across chat adapters, /login <userIdString> <userToken> to login on another adapter"),L=r.i(s.b)("public"),S=r.i(s.d)(/^login\s*(\S+)?\s*(\S+)?$/i),G=D=function(e){function t(){var e,r,n,a;i(this,t);for(var u=arguments.length,s=Array(u),p=0;p<u;p++)s[p]=arguments[p];return r=n=o(this,(e=t.__proto__||Object.getPrototypeOf(t)).call.apply(e,[this].concat(s))),n.name="permissions",n.defaultDatabase={permissions:{}},n.propTypes={adminPassword:c.PropTypes.string.isRequired},a=r,o(n,a)}return a(t,e),B(t,[{key:"admin",value:function(){function e(e,t){return r.apply(this,arguments)}var r=n(regeneratorRuntime.mark(function i(e,r){var n,o=F(e,2),a=o[1];return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.databaseInitialized();case 2:if(!this.options.adminPassword||a!==this.options.adminPassword){e.next=6;break}return n=t.nameToId(r.user.id),this.bot.addRole(n,"admin"),e.abrupt("return","User authorized as admin.");case 6:case"end":return e.stop()}},i,this)}));return e}()},{key:"addRoleToUser",value:function(){function e(e,t){return r.apply(this,arguments)}var r=n(regeneratorRuntime.mark(function i(e,r){var n,o,a=F(e,3),u=(a[0],a[1]),s=a[2];return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return u=t.nameToId(u),e.next=3,this.databaseInitialized();case 3:return n=void 0,e.prev=4,e.next=7,this.bot.adapters[r.adapter].getUserIdByUserName(s);case 7:n=e.sent,e.next=13;break;case 10:e.prev=10,e.t0=e["catch"](4),this.bot.log.warn(e.t0);case 13:if(o=t.nameToId(n),!o){e.next=17;break}return this.bot.addRole(o,u),e.abrupt("return",s+" added to role "+u+".");case 17:case"end":return e.stop()}},i,this,[[4,10]])}));return e}()},{key:"viewUser",value:function(){function e(e,t){return r.apply(this,arguments)}var r=n(regeneratorRuntime.mark(function i(e,r){var n,o,a,u=F(e,2),s=(u[0],u[1]);return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.databaseInitialized();case 2:return n=void 0,e.prev=3,e.next=6,this.bot.adapters[r.adapter].getUserIdByUserName(s);case 6:n=e.sent,e.next=12;break;case 9:e.prev=9,e.t0=e["catch"](3),this.bot.log.warn(e.t0);case 12:if(o=t.nameToId(n),!o){e.next=16;break}return a=this.bot.getRoles(o),e.abrupt("return",a.join(", "));case 16:case"end":return e.stop()}},i,this,[[3,9]])}));return e}()},{key:"viewEffectiveUser",value:function(){function e(e,t){return r.apply(this,arguments)}var r=n(regeneratorRuntime.mark(function i(e,r){var n,o,a,u=F(e,2),s=(u[0],u[1]);return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.databaseInitialized();case 2:return n=void 0,e.prev=3,e.next=6,this.bot.adapters[r.adapter].getUserIdByUserName(s);case 6:n=e.sent,e.next=12;break;case 9:e.prev=9,e.t0=e["catch"](3),this.bot.log.warn(e.t0);case 12:if(o=t.nameToId(n),!o){e.next=16;break}return a=this.bot.getUserRoles(o),e.abrupt("return",a.join(", "));case 16:case"end":return e.stop()}},i,this,[[3,9]])}));return e}()},{key:"removeRoleFromUser",value:function(){function e(e,t){return r.apply(this,arguments)}var r=n(regeneratorRuntime.mark(function i(e,r){var n,o,a=F(e,3),u=(a[0],a[1]),s=a[2];return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return u=t.nameToId(u),e.next=3,this.databaseInitialized();case 3:return n=void 0,e.prev=4,e.next=7,this.bot.adapters[r.adapter].getUserIdByUserName(s);case 7:n=e.sent,e.next=13;break;case 10:e.prev=10,e.t0=e["catch"](4),this.bot.log.warn(e.t0);case 13:if(o=t.nameToId(n),!o){e.next=17;break}return this.bot.removeRole(o,u),e.abrupt("return",s+" removed from role "+u+".");case 17:case"end":return e.stop()}},i,this,[[4,10]])}));return e}()},{key:"addRoleToGroup",value:function(){function e(e){return r.apply(this,arguments)}var r=n(regeneratorRuntime.mark(function i(e){var r=F(e,3),n=r[1],o=r[2];return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return o=t.nameToId(o),e.next=3,this.databaseInitialized();case 3:return this.bot.db.set("permissions.groups."+n+"."+o,!0).value(),this.bot.db.write(),e.abrupt("return",'role "'+o+'" given permission to commands under group "'+n+'".');case 6:case"end":return e.stop()}},i,this)}));return e}()},{key:"removeRoleFromGroup",value:function(){function e(e){return r.apply(this,arguments)}var r=n(regeneratorRuntime.mark(function i(e){var r,n=F(e,3),o=n[1],a=n[2];return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return a=t.nameToId(a),e.next=3,this.databaseInitialized();case 3:return r=this.bot.db.get("permissions.groups."+o).value(),delete r[a],this.bot.db.set("permissions.groups."+o,r).value(),this.bot.db.write(),e.abrupt("return",'role "'+a+'" removed permission to commands under group "'+o+'".');case 8:case"end":return e.stop()}},i,this)}));return e}()},{key:"viewGroup",value:function(){function e(e){return t.apply(this,arguments)}var t=n(regeneratorRuntime.mark(function r(e){var t,n=F(e,2),i=n[1];return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.databaseInitialized();case 2:return t=Object.keys(this.bot.db.get("permissions.groups."+i).value()),e.abrupt("return",t.join(", "));case 4:case"end":return e.stop()}},r,this)}));return e}()},{key:"multipleAdapterLogin",value:function(){function e(e,r){return t.apply(this,arguments)}var t=n(regeneratorRuntime.mark(function i(e,t){var n,o=F(e,3),a=o[1],u=o[2];return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.databaseInitialized();case 2:if(!a||!u){e.next=9;break}if(n=this.bot.users.botUsers[a],!n||n.id===t.user.id){e.next=8;break}if(n.token!==u){e.next=8;break}return n.token=void 0,e.abrupt("return",this.bot.mergeUsers(n,t.user));case 8:return e.abrupt("return","Wrong userId or token specified");case 9:return u=r.i(p.v4)(),t.user.token=u,e.abrupt("return","Please whisper this to the bot on the other adapter \n"+("login "+t.user.id+" "+u));case 12:case"end":return e.stop()}},i,this)}));return e}()}]),t}(s.e),D.nameToId=function(e){if(e)return e.replace(/[^\w-]/g,"").toLowerCase()},A=G,u(A.prototype,"admin",[l,f,h],Object.getOwnPropertyDescriptor(A.prototype,"admin"),A.prototype),u(A.prototype,"addRoleToUser",[d,v,b],Object.getOwnPropertyDescriptor(A.prototype,"addRoleToUser"),A.prototype),u(A.prototype,"viewUser",[y,m,g],Object.getOwnPropertyDescriptor(A.prototype,"viewUser"),A.prototype),u(A.prototype,"viewEffectiveUser",[w,x,O],Object.getOwnPropertyDescriptor(A.prototype,"viewEffectiveUser"),A.prototype),u(A.prototype,"removeRoleFromUser",[k,P,j],Object.getOwnPropertyDescriptor(A.prototype,"removeRoleFromUser"),A.prototype),u(A.prototype,"addRoleToGroup",[R,_,T],Object.getOwnPropertyDescriptor(A.prototype,"addRoleToGroup"),A.prototype),u(A.prototype,"removeRoleFromGroup",[E,U,I],Object.getOwnPropertyDescriptor(A.prototype,"removeRoleFromGroup"),A.prototype),u(A.prototype,"viewGroup",[C,q,z],Object.getOwnPropertyDescriptor(A.prototype,"viewGroup"),A.prototype),u(A.prototype,"multipleAdapterLogin",[N,L,S],Object.getOwnPropertyDescriptor(A.prototype,"multipleAdapterLogin"),A.prototype),A)},function(e,t){e.exports=require("cryptr")},function(e,t){e.exports=require("fs-extra")},function(e,t){e.exports=require("lowdb")},function(e,t){e.exports=require("readline")},function(e,t){e.exports=require("underscore-db")},function(e,t,r){"use strict";function n(e){return function(){var t=e.apply(this,arguments);return new Promise(function(e,r){function n(i,o){try{var a=t[i](o),u=a.value}catch(s){return void r(s)}return a.done?void e(u):Promise.resolve(u).then(function(e){return n("next",e)},function(e){return n("throw",e)})}return n("next")})}}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var o=r(13),a=r.n(o),u=r(16),s=r.n(u),c=r(17),p=r.n(c),l=r(18),f=r.n(l),h=r(15),d=(r.n(h),r(14)),v=(r.n(d),r(34)),b=r.n(v),y=r(6),m=r(2),g=r(11),w=r(3),x=r(12),O=r(7);r.d(t,"PropTypes",function(){return T}),r.d(t,"Exobot",function(){return I}),r.d(t,"LogLevels",function(){return C});for(var k in g)["PropTypes","Exobot","User","LogLevels","default"].indexOf(k)<0&&function(e){r.d(t,e,function(){return g[e]})}(k);for(var k in w)["PropTypes","Exobot","User","LogLevels","default"].indexOf(k)<0&&function(e){r.d(t,e,function(){return w[e]})}(k);for(var k in x)["PropTypes","Exobot","User","LogLevels","default"].indexOf(k)<0&&function(e){r.d(t,e,function(){return x[e]})}(k);for(var k in m)["PropTypes","Exobot","User","LogLevels","default"].indexOf(k)<0&&function(e){r.d(t,e,function(){return m[e]})}(k);r.o(O,"a")&&r.d(t,"User",function(){return O.a});var P,j,R,_=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),T=b.a;f.a.Promise=Promise;var E=f.a.patch(p.a),U="exobot-users",I=(j=P=function(){function e(t){var r=arguments.length<=1||void 0===arguments[1]?{}:arguments[1];i(this,e),R.call(this),this.name=t,this.alias=r.alias,this.emitter=new a.a,this.http=E,this.requirePermissions=r.requirePermissions,this.initLog(r.logLevel||s.a.WARNING),process.on("unhandledRejection",this.log.critical.bind(this.log));var n=r.dbPath||"./data/"+t+".json";this.initDB(r.key,n,r.readFile,r.writeFile),this.initUsers(),this.initAdapters(r.adapters),this.initPlugins(r.plugins)}return _(e,[{key:"initUsers",value:function(){function e(){return t.apply(this,arguments)}var t=n(regeneratorRuntime.mark(function r(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.databaseInitialized();case 2:if(this.users=this.db.get(U).value(),!this.users){e.next=6;break}return this.log.debug(Object.keys(this.users.botUsers).length,"exobot users"),e.abrupt("return");case 6:this.db.set(U,{botUsers:{}}).value(),this.users=this.db.get(U).value();case 8:case"end":return e.stop()}},r,this)}));return e}()},{key:"mergeUsers",value:function(e,t){var n=this;if(e&&t)return r.i(d.merge)(e.roles,t.roles),Object.keys(t.adapters).map(function(r){n.users[r][t.adapters[r].userId].botId=e.id}),r.i(d.merge)(e.adapters,t.adapters),delete this.users.botUsers[t.id],this.db.write(),"Login complete"}},{key:"addRole",value:function(e,t){this.users.botUsers[e].roles[t]=!0,this.db.write()}},{key:"getRoles",value:function(e){return Object.keys(this.users.botUsers[e].roles)}},{key:"removeRole",value:function(e,t){var r=this.users.botUsers[e].roles;delete r[t],this.db.write()}},{key:"getUserRoles",value:function(e){var t=this,r=this.users.botUsers[e],n=[];if(r)return Object.keys(r.adapters).map(function(e){var i=t.adapters[e].getRolesForUser(r.adapters[e].userId);i&&(n=n.concat(i))}),n=n.concat(Object.keys(r.roles))}},{key:"checkPermissions",value:function(){function e(e,r){return t.apply(this,arguments)}var t=n(regeneratorRuntime.mark(function i(e,t){var n,o;return regeneratorRuntime.wrap(function(i){for(;;)switch(i.prev=i.next){case 0:if(this.usePermissions){i.next=2;break}return i.abrupt("return",!0);case 2:if("permissions.public"!==t){i.next=4;break}return i.abrupt("return",!0);case 4:return i.next=6,this.databaseInitialized();case 6:if(n=this.getUserRoles(e),!n||!n.includes("admin")){i.next=9;break}return i.abrupt("return",!0);case 9:if(o=this.db.get("permissions.groups."+t).value(),o&&Object.keys(o)){i.next=14;break}if(this.requirePermissions){i.next=13;break}return i.abrupt("return",!0);case 13:return i.abrupt("return",!1);case 14:if(!o["public"]){i.next=16;break}return i.abrupt("return",!0);case 16:if(!r.i(h.intersection)(n,Object.keys(o)).length){i.next=18;break}return i.abrupt("return",!0);case 18:return i.abrupt("return",!1);case 19:case"end":return i.stop()}},i,this)}));return e}()},{key:"databaseInitialized",value:function(){function e(){return t.apply(this,arguments)}var t=n(regeneratorRuntime.mark(function r(){var e=this;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(!this.db){t.next=2;break}return t.abrupt("return",!0);case 2:return t.abrupt("return",new Promise(function(t){e.emitter.on("dbLoaded",t)}));case 3:case"end":return t.stop()}},r,this)}));return e}()},{key:"addPlugin",value:function(e){e.register(this),this.plugins.push(e)}},{key:"addAdapter",value:function(e){var t=e.name;this.getAdapterByName(t)&&this.log.warning('Multiple "'+t+'" adapters were initialized.'),e.register(this),this.adapters[e.name]=e}},{key:"prependNameForWhisper",value:function(e){return e.slice(0,this.name.length).toLowerCase()!==this.name.toLowerCase()&&e.slice(0,this.alias.length).toLowerCase()!==this.alias.toLowerCase()&&(e=this.name+" "+e),e}},{key:"send",value:function(e){if(e.text){var t=this.getAdapterByMessage(e);return t?void t.send(e):void this.log.warning("Message sent with invalid adapter: "+e.adapter)}}},{key:"getAdapterByMessage",value:function(e){return this.adapters[e.adapter]}},{key:"getAdapterByName",value:function(e){var t=this;return Object.keys(this.adapters).map(function(e){return t.adapters[e]}).find(function(t){return t.name.toLowerCase()===e.toLowerCase()})}}]),e}(),R=function(){var e=this;this.plugins=[],this.adapters={},this.initAdapters=function(){var t=arguments.length<=0||void 0===arguments[0]?[]:arguments[0];t.forEach(function(t){return e.addAdapter(t)})},this.initPlugins=function(){var t=arguments.length<=0||void 0===arguments[0]?[]:arguments[0];t.forEach(function(t){e.addPlugin(t),t instanceof y.Permissions&&(e.usePermissions=!0)})},this.initLog=function(t){var r=new s.a(t||s.a.WARNING);e.log=r,e.logLevel=t,t===s.a.DEBUG&&setInterval(e.logProcess,1e4)},this.initDB=function(t,n,i,o){return t?void r.i(m.DB)({key:t,readFile:i,writeFile:o,path:n,emitter:e.emitter}).then(function(t){e.db=t,e.emitter.emit("dbLoaded",t)},e.log.critical.bind(e.log)):void e.log.critical("Pass options.key in to bot initializer. Database not initializing.")},this.logProcess=function(){e.log.debug(process.memoryUsage(),process.cpuUsage())}},j),C=s.a},,function(e,t){e.exports=require("proptypes")}])});
//# sourceMappingURL=exobot.js.map